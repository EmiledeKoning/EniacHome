@model IEnumerable<MVC_default.Areas.Admin.Models.PluginListViewModel>
<script language="JavaScript" type="text/javascript" src="~/Scripts/jquery-2.1.4.min.js"></script>
<script>

    $(function () {
        var upload = function (files) {
            var formData = new FormData(),
                xhr = new XMLHttpRequest();

            for (i = 0; i < files.length; i++)
            {
                formData.append(files[i].name, files[i]);
            }

            xhr.open('post', '@Url.Action("Add", "Plugin", new { area="Admin"})');
            xhr.setRequestHeader('__RequestVerificationToken', $('[name=__RequestVerificationToken]').val())
            xhr.send(formData);

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200)
                {
                    alert(files.length + " files uploaded");
                }
            }
        };

        document.getElementById("FileInput").onchange = function(e) {
            upload(this.files);
        };

        $('#addBtn').on('click', function (e) {
            $('#overlay').css({
                'display': 'flex'
            });
        });

        $('#overlay').on('click', function (e) {
            if (e.target !== this)
                return;
            $('#overlay').css({
                'display': 'none'
            });
        });

        $('#overlay').on('dragover drop dragdrop', function (e) {
            e.preventDefault();
        });

        $("div > div", "#overlay").on('drop dragdrop', function (event) {
            $(this).css({
                'color': '#ccc',
                'border-color': '#ccc'
            });

            upload(event.originalEvent.dataTransfer.files);
        });

        $("div > div", "#overlay").on('dragleave', function (event) {
            event.preventDefault();
            $(this).css({
                'color': '#ccc',
                'border-color': '#ccc'
            });
        });

        $("div > div", "#overlay").on('dragenter', function (event) {
            event.preventDefault();
            $(this).css({
                'color': '#000',
                'border-color': '#000'
            });
        });
    });
</script>
@Html.AntiForgeryToken()
<div class="overlay" id="overlay">
    <div class="content" id="content">
        <div class="hidden-xs dropzone" id="dropzone">Drop files here to upload</div>
        <div class="visible-xs center-block">
            <p>
                @using (Html.BeginForm("Add", "Plugin", FormMethod.Post, new { id = "upload", enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken();
                    <span class="btn btn-default btn-file">
                        Browse<input type="file" name="files" id="FileInput" multiple="multiple" />
                    </span>
                }
            </p>
        </div>
    </div>
</div>
<div class="table-responsive">
    <table class="table">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Author)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Version)
            </th>
            <th></th>
        </tr>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Author)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Version)
                </td>
                <td>
                    @Html.ActionLink("Details", "Details", new { Name = item.Name }) |
                    @Html.ActionLink("Delete", "Delete", new { Name = item.Name })
                </td>
            </tr>
        }
    </table>
</div>
<p>
    <button class="btn btn-default" id="addBtn">
        <span class="glyphicon glyphicon-plus pull-left"></span>&nbsp; &nbsp; Add New Plugin
    </button>
</p>
